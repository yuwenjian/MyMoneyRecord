# 🚨 修复：总盈亏误识别为总市值

## 问题现象

**用户反馈：**
- 应该识别：总市值 42,047.00
- 实际识别：总市值 31,842.59（这是"总盈亏"的金额！）

## 根本原因

**关键词冲突问题**

同花顺截图中包含多个字段：
```
总资产
168,850.80  ← ✓ 正确识别

总市值
42,047.00   ← 应该识别这个！

总盈亏（或"当日参考盈亏"）
+31,842.59  ← ✗ 系统错误地把这个识别成了总市值！
```

**为什么会识别错误？**

1. "总盈亏"的金额 31,842.59 在合理范围内（小于总资产）✓
2. 没有排除"盈亏"关键词导致误匹配 ✗
3. OCR可能把"总盈亏"识别为类似的文字 ✗

## 核心修复

### 1. 新增排除关键词列表

```javascript
const patterns = {
  totalAsset: /总资产|账户总资产|资产总额/i,
  totalMarketValue: /总市值|市值/i,
  
  // 🆕 新增：需要排除的盈亏相关关键词
  excludeKeywords: /盈亏|盈利|亏损|收益|利润|参考盈亏|当日.*盈亏|累计盈亏/i,
}
```

### 2. 总市值识别时排除盈亏行（重点）

```javascript
// 修改后：检查下一行是否包含盈亏关键词
if ((!num || num < 100) && lines[index + 1]) {
  const nextLine = lines[index + 1]
  if (!patterns.excludeKeywords.test(nextLine)) {
    num = extractNumber(nextLine)
  } else {
    console.log(`→ 下一行包含盈亏关键词，跳过`)  // ✓ 31842.59被跳过
  }
}
```

## 测试场景

### 场景：带"总盈亏"字段

**输入：**
```
总资产
168,850.80

总市值
42,047.00

总盈亏
+31,842.59
```

**预期输出：**
- ✅ 总资产：168850.80
- ✅ 总市值：42047.00（不是31842.59）
- ❌ 不识别：31842.59（盈亏数据）

## 立即测试

1. **刷新页面**（Ctrl/Cmd + Shift + R）
2. 清除旧图，重新上传
3. 查看识别结果

**预期：总市值 = 42047 ✓**

---

**🎯 修复完成！请刷新测试！** 🚀

