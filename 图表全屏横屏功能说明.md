# 📱 图表全屏横屏显示功能

## 功能概述

为统计分析页面的图表添加全屏和横屏显示功能，让用户可以更清晰地查看数据趋势。

### ✨ 核心特性

1. ✅ **一键全屏** - 点击按钮即可全屏显示图表
2. ✅ **自动横屏** - 全屏后自动尝试横屏锁定
3. ✅ **响应式布局** - 全屏时图表自动适应屏幕尺寸
4. ✅ **多种退出方式** - 按钮退出或ESC键退出
5. ✅ **跨浏览器兼容** - 支持各主流浏览器和移动设备

## 使用方法

### 进入全屏

```
方法1：点击全屏按钮
  图表右上角 → "⛶" 按钮 → 点击
  
方法2：触屏设备
  轻触全屏按钮即可
```

### 退出全屏

```
方法1：点击退出按钮
  全屏状态下 → "🗗" 按钮 → 点击
  
方法2：键盘快捷键
  按 ESC 键
  
方法3：手势操作（移动设备）
  从屏幕顶部向下滑动
```

## 功能展示

### 正常模式

```
┌─────────────────────────────────┐
│ 📊 对比趋势图 (盈亏百分比)      │
│                                 │
│    [收起] [⛶全屏] [📈] [📊]     │
│    [日] [周] [月] [年]          │
│                                 │
│    ╱╲                           │
│   ╱  ╲    ╱╲                    │
│  ╱    ╲  ╱  ╲                   │
│ ╱      ╲╱    ╲                  │
│                                 │
└─────────────────────────────────┘
         图表高度: 400px
```

### 全屏横屏模式

```
┌───────────────────────────────────────────────────────────────┐
│ 📊 对比趋势图  [🗗退出] [📈] [📊] [日][周][月][年]              │
│                                                               │
│                     ╱╲                                        │
│                    ╱  ╲                                       │
│                   ╱    ╲         ╱╲                           │
│                  ╱      ╲       ╱  ╲                          │
│                 ╱        ╲     ╱    ╲                         │
│                ╱          ╲   ╱      ╲                        │
│               ╱            ╲ ╱        ╲                       │
│              ╱              ╲          ╲                      │
│                                                               │
└───────────────────────────────────────────────────────────────┘
                   图表高度: 100vh - 80px
                   全屏 + 横屏模式
```

## 技术实现

### 1. 全屏 API

使用标准 Fullscreen API 及各浏览器兼容版本：

```javascript
// 进入全屏
if (element.requestFullscreen) {
  await element.requestFullscreen()
} else if (element.webkitRequestFullscreen) {
  await element.webkitRequestFullscreen()  // Safari
} else if (element.mozRequestFullScreen) {
  await element.mozRequestFullScreen()     // Firefox
} else if (element.msRequestFullscreen) {
  await element.msRequestFullscreen()      // IE/Edge
}
```

### 2. 屏幕方向锁定

使用 Screen Orientation API 锁定横屏：

```javascript
// 锁定横屏
if (screen.orientation && screen.orientation.lock) {
  await screen.orientation.lock('landscape')
}

// 解锁方向
if (screen.orientation && screen.orientation.unlock) {
  screen.orientation.unlock()
}
```

### 3. 状态监听

监听全屏状态变化：

```javascript
useEffect(() => {
  const handleFullScreenChange = () => {
    setIsFullScreen(!!document.fullscreenElement)
  }
  
  // 监听多个浏览器的全屏事件
  document.addEventListener('fullscreenchange', handleFullScreenChange)
  document.addEventListener('webkitfullscreenchange', handleFullScreenChange)
  document.addEventListener('mozfullscreenchange', handleFullScreenChange)
  document.addEventListener('MSFullscreenChange', handleFullScreenChange)
  
  return () => {
    // 清理监听器
  }
}, [])
```

### 4. 响应式高度

根据全屏状态动态调整图表高度：

```javascript
<div style={{ height: isFullScreen ? '100%' : '400px' }}>
  {chartType === 'line' && <Line data={chartData} options={chartOptions} />}
</div>
```

## UI 设计

### 全屏按钮样式

**图标：**
- 进入全屏：`⛶` (全屏图标)
- 退出全屏：`🗗` (窗口化图标)

**按钮设计：**
```css
.chart-fullscreen-btn {
  background: white;
  border: 1px solid #e0e0e0;
  border-radius: 6px;
  padding: 8px 14px;
  font-size: 18px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.chart-fullscreen-btn:hover {
  background: #e74c3c;
  color: white;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
}
```

### 全屏容器样式

```css
.chart-container.fullscreen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 9999;
  background: var(--bg-primary);
  padding: 20px;
}
```

### 横屏模式优化

```css
@media screen and (orientation: landscape) {
  .chart-container.fullscreen {
    padding: 15px;
  }

  .chart-container.fullscreen .chart-panel {
    height: calc(100vh - 80px) !important;
  }
}
```

## 浏览器兼容性

### 桌面浏览器

| 浏览器 | 版本 | 全屏支持 | 方向锁定 |
|--------|------|---------|---------|
| Chrome | 71+ | ✅ | ✅ |
| Firefox | 64+ | ✅ | ⚠️ 部分支持 |
| Safari | 16.4+ | ✅ | ⚠️ 部分支持 |
| Edge | 79+ | ✅ | ✅ |

### 移动浏览器

| 浏览器 | 系统 | 全屏支持 | 方向锁定 |
|--------|------|---------|---------|
| Chrome | Android | ✅ | ✅ |
| Safari | iOS 16.4+ | ✅ | ⚠️ 需要添加到主屏幕 |
| Firefox | Android | ✅ | ✅ |
| Edge | Android | ✅ | ✅ |

**注意：**
- ⚠️ iOS Safari 的全屏 API 支持有限，需要特殊处理
- ⚠️ 屏幕方向锁定在某些设备上需要用户交互才能触发

## 使用场景

### 场景 1：数据分析

```
用户需要详细分析股票和基金的收益趋势：
1. 点击全屏按钮
2. 手机自动横屏
3. 图表占满整个屏幕
4. 更清晰地查看数据点和趋势线
```

### 场景 2：展示汇报

```
用户需要向他人展示投资数据：
1. 进入全屏模式
2. 横屏显示，画面更大
3. 切换不同的图表类型（折线图/柱状图）
4. 调整时间周期（日/周/月/年）
```

### 场景 3：截图保存

```
用户需要保存图表截图：
1. 全屏显示图表
2. 横屏获得最佳比例
3. 使用系统截图功能
4. 获得高质量的数据图表
```

## 功能优化

### 1. 自动横屏锁定

```javascript
// 进入全屏后尝试锁定横屏
try {
  if (screen.orientation && screen.orientation.lock) {
    await screen.orientation.lock('landscape')
  }
} catch (err) {
  // 某些设备不支持，静默失败
  console.log('无法锁定屏幕方向:', err)
}
```

### 2. 退出提示动画

```css
.chart-container.fullscreen::before {
  content: '按 ESC 或点击退出按钮退出全屏';
  animation: fadeInOut 3s ease-in-out;
}

@keyframes fadeInOut {
  0% { opacity: 0; }
  10% { opacity: 1; }
  90% { opacity: 1; }
  100% { opacity: 0; }
}
```

### 3. 移动端优化

```css
@media (max-width: 600px) {
  .chart-container.fullscreen {
    padding: 10px;
  }

  .chart-container.fullscreen .chart-panel {
    height: calc(100vh - 70px) !important;
  }
}
```

### 4. 暗色模式支持

```css
[data-theme="dark"] .chart-container.fullscreen {
  background: var(--bg-primary);
}

[data-theme="dark"] .chart-fullscreen-btn {
  background: var(--bg-card);
  border-color: var(--border-color);
  color: var(--text-primary);
}
```

## 交互细节

### 按钮状态

**正常状态：**
```
┌──────────┐
│    ⛶    │  全屏图标
└──────────┘
```

**悬停状态：**
```
┌──────────┐
│    ⛶    │  红色背景，白色图标
└──────────┘  向上轻微浮动，阴影加深
```

**全屏状态：**
```
┌──────────┐
│    🗗    │  退出全屏图标
└──────────┘
```

### 控制栏布局

**正常模式：**
```
[收起] [⛶] [📈] [📊] [🥧] [日] [周] [月] [年] [☑️ 移动平均线]
```

**全屏模式：**
```
[🗗] [📈] [📊] [🥧] [日] [周] [月] [年] [☑️ 移动平均线]
```
（收起按钮自动隐藏）

## 性能优化

### 1. 高度计算优化

```javascript
// 使用 CSS calc() 动态计算
height: isFullScreen ? '100%' : '400px'

// CSS 中使用 calc
.chart-container.fullscreen .chart-panel {
  height: calc(100vh - 80px) !important;
}
```

### 2. 渲染优化

```javascript
// 全屏时图表自动重绘以适应新尺寸
// Chart.js 会自动响应容器尺寸变化
```

### 3. 事件监听清理

```javascript
useEffect(() => {
  // ... 添加监听器 ...
  
  return () => {
    // 组件卸载时清理所有监听器
    document.removeEventListener('fullscreenchange', handleFullScreenChange)
    // ...
  }
}, [])
```

## 错误处理

### 1. 全屏 API 不可用

```javascript
try {
  await chartContainer.requestFullscreen()
} catch (err) {
  console.error('全屏切换失败:', err)
  toast.error('全屏功能不可用')
}
```

### 2. 方向锁定失败

```javascript
try {
  await screen.orientation.lock('landscape')
} catch (err) {
  // 静默失败，不影响全屏功能
  console.log('无法锁定屏幕方向:', err)
}
```

### 3. 权限被拒绝

```
某些浏览器需要用户交互才能进入全屏：
- 必须由用户点击触发
- 不能在页面加载时自动全屏
- 不能在异步回调中全屏
```

## 键盘快捷键

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `ESC` | 退出全屏 | 浏览器默认行为 |
| `F11` | 浏览器全屏 | 仅桌面浏览器 |

## 触屏手势

| 手势 | 功能 | 平台 |
|------|------|------|
| 点击全屏按钮 | 进入全屏 | 所有设备 |
| 从顶部下滑 | 退出全屏 | Android |
| 点击退出按钮 | 退出全屏 | 所有设备 |

## 测试清单

### 桌面测试

- ✅ Chrome 浏览器全屏
- ✅ Firefox 浏览器全屏
- ✅ Safari 浏览器全屏
- ✅ Edge 浏览器全屏
- ✅ 键盘 ESC 退出
- ✅ 按钮退出全屏
- ✅ 窗口大小变化响应

### 移动端测试

- ✅ Android Chrome 全屏
- ✅ Android Chrome 横屏锁定
- ✅ iOS Safari 全屏（16.4+）
- ✅ 触屏点击响应
- ✅ 手势退出全屏
- ✅ 屏幕旋转适配

### 功能测试

- ✅ 折线图全屏显示
- ✅ 柱状图全屏显示
- ✅ 饼图全屏显示
- ✅ 切换图表类型（全屏中）
- ✅ 切换时间周期（全屏中）
- ✅ 移动平均线显示（全屏中）
- ✅ 暗色模式下全屏

## 已知问题

### iOS Safari 限制

**问题：**
- iOS Safari < 16.4 不支持全屏 API
- 需要将应用添加到主屏幕才能获得完整全屏体验

**解决方案：**
```javascript
// 检测 iOS Safari
const isIOSSafari = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream

if (isIOSSafari && !document.fullscreenEnabled) {
  toast.info('请将应用添加到主屏幕以获得最佳体验')
}
```

### Firefox 方向锁定

**问题：**
- Firefox 对屏幕方向锁定支持有限

**解决方案：**
- 静默失败，不影响全屏功能
- 用户可以手动旋转设备

## 代码文件

### 修改的文件

1. **src/pages/StatisticsPage.jsx**
   - 添加全屏状态监听
   - 添加全屏切换函数
   - 添加全屏按钮UI
   - 修改图表容器高度逻辑

2. **src/styles/StatisticsPage.css**
   - 添加全屏容器样式
   - 添加全屏按钮样式
   - 添加横屏模式优化
   - 添加移动端适配
   - 添加暗色模式支持

## 使用建议

### 最佳实践

1. **数据分析时**
   - 使用横屏模式查看长时间跨度的数据
   - 折线图更适合全屏查看趋势

2. **数据对比时**
   - 使用柱状图全屏对比不同时期数据
   - 周期选择"月"或"年"更清晰

3. **展示汇报时**
   - 全屏模式展示更专业
   - 可以实时切换图表类型和周期

### 注意事项

1. ⚠️ 确保设备允许屏幕旋转
2. ⚠️ iOS 用户建议更新到 iOS 16.4+
3. ⚠️ 全屏时避免频繁切换，以免影响体验

---

## ✅ 功能已完成！

**新增功能：**
- ✅ 图表全屏显示
- ✅ 自动横屏锁定
- ✅ 响应式布局优化
- ✅ 多种退出方式
- ✅ 跨平台兼容

**使用方法：**
1. 点击图表右上角的 ⛶ 按钮
2. 图表自动全屏并尝试横屏
3. 点击 🗗 按钮或按 ESC 键退出

**适用场景：**
- 📊 详细数据分析
- 💼 展示汇报
- 📸 截图保存
- 🔍 趋势观察

---

**🚀 请刷新页面测试全屏功能！**

点击图表的全屏按钮，体验横屏大图显示效果！📱✨

