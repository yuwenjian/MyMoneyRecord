# 收益目标功能说明

## 📋 功能概述

收益目标功能允许用户为股票和基金分别设置每周、每月、每年的收益目标，系统会根据实际收益显示进度条，并在达成目标时播放烟花动画庆祝。

## 🎯 功能特性

### 1. 目标设置
- **分别设置**：股票和基金可以分别设置目标
- **多周期支持**：支持每周、每月、每年三种周期
- **灵活配置**：每周目标可以自定义周期开始日期（默认为本周一）

### 2. 进度展示
- **实时计算**：根据实际收益自动计算完成度
- **可视化进度条**：直观显示目标完成百分比
- **详细信息**：显示实际收益和目标金额

### 3. 达成庆祝
- **烟花动画**：达成目标时自动播放烟花动画
- **视觉反馈**：进度条变为绿色并闪烁
- **一次性提醒**：每个目标只提醒一次，避免重复

## 📁 文件结构

### 新增文件

1. **`src/utils/targetCalculations.js`**
   - 目标进度计算工具函数
   - 周期日期计算
   - 实际收益计算
   - 完成度计算

2. **`src/components/ProgressBar.jsx`**
   - 进度条组件
   - 显示完成百分比
   - 达成目标时的视觉反馈

3. **`src/components/Fireworks.jsx`**
   - 烟花动画组件
   - 粒子系统动画
   - 庆祝文字显示

4. **`src/components/TargetSettings.jsx`**
   - 目标设置组件
   - 目标编辑表单
   - 目标管理界面

5. **`src/styles/ProgressBar.css`**
   - 进度条样式

6. **`src/styles/Fireworks.css`**
   - 烟花动画样式

7. **`src/styles/TargetSettings.css`**
   - 目标设置弹窗样式

### 修改文件

1. **`src/utils/storage.js`**
   - 新增 `getProfitTargets()` - 获取所有目标
   - 新增 `saveProfitTarget()` - 保存目标
   - 新增 `deleteProfitTarget()` - 删除目标

2. **`src/pages/StatisticsPage.jsx`**
   - 集成目标进度展示
   - 添加目标设置按钮
   - 添加烟花动画触发逻辑

3. **`src/styles/StatisticsPage.css`**
   - 新增目标进度卡片样式

## 🗄️ 数据库结构

### LeanCloud 表：`ProfitTarget`

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `investmentType` | String | 投资类型：'stock' 或 'fund' |
| `period` | String | 周期：'week'、'month' 或 'year' |
| `targetAmount` | Number | 目标金额 |
| `periodStartDate` | String | 周期开始日期（仅周目标使用，格式：YYYY-MM-DD） |

**唯一性约束：** `investmentType` + `period` 组合唯一

## 🔧 使用方法

### 1. 设置目标

1. 打开"统计分析"页面
2. 找到"收益目标进度"卡片
3. 点击右上角的 ⚙️ 按钮
4. 在弹出的设置窗口中：
   - 选择投资类型（股票/基金）
   - 选择周期（每周/每月/每年）
   - 输入目标金额
   - 如果是每周目标，可选择周期开始日期（默认为本周一）
5. 点击"保存"

### 2. 查看进度

- 目标进度会自动显示在"收益目标进度"卡片中
- 每个目标显示：
  - 标签（如：股票 - 每月）
  - 完成百分比
  - 实际收益金额
  - 目标金额
  - 进度条可视化

### 3. 达成目标

- 当实际收益达到或超过目标时：
  - 进度条变为绿色并闪烁
  - 自动播放烟花动画（3秒）
  - 显示"🎉 目标达成！🎉"文字
  - 每个目标只提醒一次

## 📊 计算逻辑

### 周期定义

- **每周**：从指定的周一（或本周一）开始，持续7天
- **每月**：从当月1日开始，到当月最后一天
- **每年**：从当年1月1日开始，到当年12月31日

### 收益计算

实际收益 = 周期内每日盈亏的累加

每日盈亏计算公式：
```
每日盈亏 = 今日总资产 - 加减仓金额 - 上个交易日总资产
```

### 完成度计算

```
完成度百分比 = (实际收益 / 目标金额) × 100%
```

- 最大显示 100%
- 超过目标时，进度条显示 100% 并标记为已达成

## 🎨 UI 设计

### 进度条状态

1. **未达成**（0% - 99.9%）
   - 蓝色渐变背景
   - 显示当前百分比

2. **已达成**（≥ 100%）
   - 绿色渐变背景
   - 闪烁动画效果
   - 百分比文字加粗

### 烟花动画

- 3个爆炸点随机分布
- 每个爆炸点30个粒子
- 多种颜色（金色、红色、青色等）
- 重力效果和衰减动画
- 3秒后自动消失

## 🔄 数据同步

- 目标设置实时保存到 LeanCloud
- 每次打开页面自动加载目标
- 每次加载统计数据时更新进度
- 达成目标状态本地缓存，避免重复提醒

## 📱 响应式设计

- **桌面端**：完整功能展示
- **移动端**：
  - 进度条高度适配
  - 字体大小优化
  - 触摸友好的按钮尺寸
  - 烟花动画性能优化

## ⚠️ 注意事项

1. **周期开始日期**
   - 每周目标可以自定义周期开始日期
   - 如果不设置，默认使用本周一
   - 建议设置为周一，便于统计

2. **目标更新**
   - 修改目标会覆盖原有目标
   - 删除目标后，相关进度不再显示

3. **数据依赖**
   - 目标进度依赖历史记录数据
   - 确保有足够的记录数据才能准确计算

4. **达成提醒**
   - 每个目标只提醒一次
   - 刷新页面后，已提醒的目标不会再次提醒
   - 如需重新提醒，可以删除并重新设置目标

## 🐛 故障排除

### 目标进度不显示

1. 检查是否已设置目标
2. 检查是否有对应的历史记录数据
3. 检查浏览器控制台是否有错误

### 烟花动画不播放

1. 检查浏览器是否支持动画
2. 检查是否已达成目标（实际收益 ≥ 目标金额）
3. 检查是否已经提醒过（避免重复提醒）

### 进度计算不准确

1. 检查历史记录数据是否完整
2. 检查加减仓记录是否正确
3. 检查周期开始日期设置是否正确

## 🚀 未来优化

- [ ] 支持自定义周期（如：每两周、每季度）
- [ ] 支持目标历史记录查看
- [ ] 支持目标达成统计报表
- [ ] 支持目标提醒通知
- [ ] 支持目标分享功能

---

**功能已实现！** 🎉

现在可以在"统计分析"页面设置收益目标，查看进度，并在达成目标时享受烟花庆祝！

