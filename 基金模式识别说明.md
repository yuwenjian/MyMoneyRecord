# 🎯 基金模式识别逻辑（最新版）

## 核心需求

**基金类型只识别总资产**，不识别持有收益、日收益等其他数据。

## 识别目标

### 基金模式（简化版）

```
┌──────────────────────┐
│ 🟡 基金资产(元)        │
│ 128,810.18          │ ← 只识别这个！
│                     │
│ 日收益 (12-22)      │
│ +1,413.48           │ ← 忽略
│                     │
│ 持有收益             │
│ +21,579.33          │ ← 忽略
│                     │
│ 累计收益             │
│ +43,470.95          │ ← 忽略
└──────────────────────┘
```

**识别结果：**
```javascript
{
  totalAsset: 128810.18,    // ✅ 识别
  totalMarketValue: null,   // ❌ 不识别
  shanghaiIndex: null       // ❌ 可选
}
```

## 关键词配置

### 基金模式关键词

```javascript
const getFundPatterns = () => {
  return {
    // 总资产 - 优先识别"基金资产(元)"
    totalAsset: /基金资产|基金总额|总资产|账户总资产|资产总额/i,
    
    // 不识别市值/收益
    totalMarketValue: null,  // ← 设置为null
    
    // 排除所有收益相关
    excludeKeywords: /收益|盈亏|盈利|亏损|利润|日收益|持有收益|累计收益/i,
  }
}
```

### 股票模式关键词（对比）

```javascript
const getStockPatterns = () => {
  return {
    totalAsset: /总资产|账户总资产|资产总额/i,
    totalMarketValue: /总市值|持有市值|市值/i,  // ← 需要识别
    excludeKeywords: /盈亏|盈利|亏损|收益|利润/i,
  }
}
```

## 识别流程

### 基金模式流程

```
选择"基金"类型
    ↓
上传支付宝/天天基金截图
    ↓
点击"识别全部"
    ↓
OCR识别文本
    ↓
发现 "基金资产(元)"  ← 关键词匹配
    ↓
提取下一行：128,810.18 ✓
    ↓
发现 "持有收益"
    ↓
跳过（totalMarketValue = null）✗
    ↓
发现 "日收益"
    ↓
跳过（在excludeKeywords中）✗
    ↓
发现 "累计收益"
    ↓
跳过（在excludeKeywords中）✗
    ↓
只填入：总资产 = 128810.18
```

## 预期日志

### 控制台输出（基金模式）

```
======== 开始解析同花顺数据 ========
投资类型: 基金
使用关键词模式: 基金模式

行5: 基金资产(元)
  → 发现总资产关键词行
  → 下一行 "128,810.18" 提取: 128810.18
  ✓ 成功识别总资产: 128810.18

行7: 日收益 (12-22)
  → 包含排除关键词，跳过

行9: 持有收益
  → totalMarketValue为null，跳过市值识别

行11: 累计收益
  → 包含排除关键词，跳过

======== 最终解析结果 ========
总资产: 128810.18
总市值: （基金模式不识别）
上证指数: null
============================
```

## 表单填写

### 基金类型表单

当选择"基金"类型并识别成功后：

```
日期：2025/12/25

投资类型：[基金]

总资产：128810.18  ← 自动填入

总市值：________   ← 留空（或隐藏该字段）
```

## 使用场景

### ✅ 适用情况

1. **支付宝基金资产页**
   - 显示"基金资产(元)"
   - 只需要记录总资产

2. **天天基金App**
   - 显示"基金总额"
   - 只需要记录总资产

3. **蚂蚁财富**
   - 显示"总金额"
   - 只需要记录总资产

### ❌ 不适用情况

- 股票账户（请选择"股票"类型）
- 需要记录持有收益的情况（请手动输入）

## 字段说明

| 类型 | 总资产 | 总市值 | 说明 |
|------|--------|--------|------|
| **股票** | ✅ 自动识别 | ✅ 自动识别 | 识别持有市值 |
| **基金** | ✅ 自动识别 | ❌ 不识别 | 只记录总资产 |

## 测试步骤

1. **刷新页面**（Ctrl/Cmd + Shift + R）

2. **选择基金类型**
   - 点击"基金"按钮

3. **上传图片**
   - 上传您的支付宝截图

4. **点击识别**
   - 点击"识别全部"按钮

5. **查看结果**
   - 总资产：应该显示 128810.18 ✓
   - 总市值：应该为空 ✓

## 预期效果

### 成功识别

```
✅ 识别成功！已自动填写: 总资产

表单状态：
- 总资产：128810.18  ✓
- 总市值：（空）     ✓
```

### 如果识别失败

请按 **F12** 查看控制台，找到：

```
行X: 基金资产(元)
  → 发现总资产关键词行
  → 下一行 "..." 提取: ...
```

如果没有这个日志，说明OCR没识别到"基金资产(元)"关键词。

## 优化建议

### 如果识别不准确

1. **确保截图清晰**
   - "基金资产(元)"文字清晰
   - 数字 128,810.18 清晰可见

2. **只截取基金部分**
   - 避免包含股票资产部分
   - 减少干扰信息

3. **光线充足**
   - 避免屏幕反光
   - 确保文字对比度高

## 与股票模式对比

| 特性 | 股票模式 | 基金模式（新）|
|------|---------|------------|
| **识别字段** | 总资产 + 总市值 | 只有总资产 |
| **关键词** | "总市值" | "基金资产" |
| **排除项** | 盈亏、收益 | 盈亏、收益（更严格）|
| **候选机制** | ✅ 启用 | ❌ 禁用 |
| **适用App** | 同花顺、东方财富 | 支付宝、天天基金 |

## 核心改进

### 1. 简化识别目标
```javascript
// 基金模式不识别市值/收益
totalMarketValue: null  // ← 关键改动
```

### 2. 更严格的排除
```javascript
// 排除所有收益相关关键词
excludeKeywords: /收益|盈亏|盈利|亏损|利润|日收益|持有收益|累计收益/i
```

### 3. 跳过候选机制
```javascript
// 只在totalMarketValue不为null时启用候选机制
if (!result.totalMarketValue && result.totalAsset && patterns.totalMarketValue) {
  // 基金模式不会执行这里
}
```

---

## 🎉 立即测试

**请您现在：**

1. **刷新页面**
2. 选择"**基金**"类型  
3. 上传支付宝截图
4. 点击"识别全部"
5. 查看是否只填入了总资产：**128810.18** ✓

---

**如果有任何问题，请告诉我！** 💪

